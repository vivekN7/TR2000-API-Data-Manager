<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TR2000 Phase 2: Detailed ERD Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            padding: 5px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.95em;
            color: #666;
            transition: all 0.3s;
            white-space: nowrap;
            border-radius: 8px;
            margin: 2px;
        }
        
        .nav-tab:hover {
            background: #f0f0f0;
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
        }
        
        .content-section {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .content-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #764ba2;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            font-size: 1.8em;
        }
        
        h3 {
            color: #667eea;
            margin: 20px 0 15px 0;
            font-size: 1.3em;
        }
        
        h4 {
            color: #764ba2;
            margin: 15px 0 10px 0;
        }
        
        /* ERD Diagram Styles */
        .erd-container {
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }
        
        .erd-diagram {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            white-space: pre;
            color: #2d2d2d;
        }
        
        /* Entity Box Styles */
        .entity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .entity-box {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .entity-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 15px;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .entity-body {
            padding: 15px;
        }
        
        .field-list {
            list-style: none;
        }
        
        .field-item {
            padding: 8px 10px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .field-item:last-child {
            border-bottom: none;
        }
        
        .field-name {
            font-weight: 600;
            color: #2d2d2d;
        }
        
        .field-type {
            font-size: 0.9em;
            color: #666;
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 4px;
        }
        
        .pk-badge {
            background: #ff6b6b;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 5px;
        }
        
        .fk-badge {
            background: #4ecdc4;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 5px;
        }
        
        /* Relationship Diagram */
        .relationship-diagram {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
        }
        
        .relationship-flow {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .rel-entity {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
            margin: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .rel-arrow {
            font-size: 2em;
            color: #667eea;
            margin: 0 10px;
        }
        
        /* Table Details */
        .table-structure {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            text-align: left;
            position: sticky;
            top: 0;
        }
        
        td {
            padding: 10px 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        tr:nth-child(even) {
            background: #fafafa;
        }
        
        /* Summary Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.95;
        }
        
        /* Legend */
        .legend {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        /* Code blocks */
        .sql-code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .sql-keyword {
            color: #66d9ef;
        }
        
        .sql-string {
            color: #e6db74;
        }
        
        .sql-comment {
            color: #75715e;
        }
        
        /* Alerts */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .alert-info {
            background: #e6f3ff;
            border-left: 4px solid #3182ce;
            color: #2c5282;
        }
        
        .alert-warning {
            background: #fffaf0;
            border-left: 4px solid #ed8936;
            color: #7c2d12;
        }
        
        /* Print styles */
        @media print {
            body {
                background: white;
            }
            .nav-tabs {
                display: none;
            }
            .content-section {
                display: block !important;
                page-break-after: always;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>TR2000 Phase 2: Detailed Entity Relationship Diagram</h1>
        <p style="font-size: 1.2em; margin-top: 10px;">Complete Database Schema Documentation</p>
    </div>
    
    <div class="container">
        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">Overview</button>
            <button class="nav-tab" onclick="showTab('master-erd')">Master ERD</button>
            <button class="nav-tab" onclick="showTab('operators-plants')">Operators & Plants</button>
            <button class="nav-tab" onclick="showTab('issues')">Issues & References</button>
            <button class="nav-tab" onclick="showTab('pcs')">PCS Tables</button>
            <button class="nav-tab" onclick="showTab('vds')">VDS Tables</button>
            <button class="nav-tab" onclick="showTab('bolt')">Bolt Tension</button>
            <button class="nav-tab" onclick="showTab('etl-control')">ETL Control</button>
            <button class="nav-tab" onclick="showTab('relationships')">Relationships</button>
            <button class="nav-tab" onclick="showTab('sql-samples')">SQL Examples</button>
        </nav>
        
        <!-- Overview Section -->
        <div id="overview" class="content-section active">
            <div class="card">
                <h2>Database Schema Overview</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">50+</div>
                        <div class="stat-label">Total Tables</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">12</div>
                        <div class="stat-label">Entity Groups</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">500+</div>
                        <div class="stat-label">Total Columns</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">31</div>
                        <div class="stat-label">API Endpoints</div>
                    </div>
                </div>
                
                <h3>Design Principles</h3>
                <div class="entity-grid">
                    <div class="entity-box">
                        <div class="entity-header">🔑 Primary Key Strategy</div>
                        <div class="entity-body">
                            <p><strong>Composite Keys:</strong> Business Key + EXTRACTION_DATE</p>
                            <p><strong>Purpose:</strong> Track historical changes over time</p>
                            <p><strong>Example:</strong> (PLANT_ID, PCS, REVISION, EXTRACTION_DATE)</p>
                        </div>
                    </div>
                    
                    <div class="entity-box">
                        <div class="entity-header">🕒 Temporal Design</div>
                        <div class="entity-body">
                            <p><strong>IS_CURRENT:</strong> Flag for latest version</p>
                            <p><strong>VALID_FROM/TO:</strong> Validity period tracking</p>
                            <p><strong>EXTRACTION_DATE:</strong> When data was captured</p>
                        </div>
                    </div>
                    
                    <div class="entity-box">
                        <div class="entity-header">📊 ETL Tracking</div>
                        <div class="entity-body">
                            <p><strong>ETL_RUN_ID:</strong> Links to specific ETL execution</p>
                            <p><strong>HASH_VALUE:</strong> For change detection</p>
                            <p><strong>Audit Fields:</strong> USER_NAME, USER_ENTRY_TIME</p>
                        </div>
                    </div>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff6b6b;"></div>
                        <span><strong>PK</strong> = Primary Key</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4ecdc4;"></div>
                        <span><strong>FK</strong> = Foreign Key</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f0f0f0;"></div>
                        <span><strong>VARCHAR2</strong> = Text Field</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffd93d;"></div>
                        <span><strong>NUMBER</strong> = Numeric Field</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #6bcf7f;"></div>
                        <span><strong>TIMESTAMP</strong> = Date/Time Field</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #a8e6cf;"></div>
                        <span><strong>CLOB</strong> = Large Text Field</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Master ERD Section -->
        <div id="master-erd" class="content-section">
            <div class="card">
                <h2>Complete Entity Relationship Diagram</h2>
                
                <div class="erd-container">
                    <pre class="erd-diagram">
┌─────────────────────────────────── MASTER ENTITY RELATIONSHIPS ───────────────────────────────────┐
│                                                                                                    │
│  ┌──────────────┐         ┌──────────────┐         ┌──────────────────┐                         │
│  │  OPERATORS   │────1:M──▶│    PLANTS    │────1:M──▶│     ISSUES      │                         │
│  └──────────────┘         └──────────────┘         └──────────────────┘                         │
│         │                        │                           │                                    │
│         │                        │                           ├──1:M──▶ PCS_REFERENCES            │
│         │                        │                           ├──1:M──▶ SC_REFERENCES             │
│         │                        │                           ├──1:M──▶ VSM_REFERENCES            │
│         │                        │                           ├──1:M──▶ VDS_REFERENCES            │
│         │                        │                           ├──1:M──▶ EDS_REFERENCES            │
│         │                        │                           ├──1:M──▶ MDS_REFERENCES            │
│         │                        │                           ├──1:M──▶ VSK_REFERENCES            │
│         │                        │                           ├──1:M──▶ ESK_REFERENCES            │
│         │                        │                           └──1:M──▶ PIPE_ELEMENT_REFERENCES  │
│         │                        │                                                                │
│         │                        ├────────1:M──────▶┌─────────────┐                             │
│         │                        │                  │     PCS     │                             │
│         │                        │                  └─────────────┘                             │
│         │                        │                         │                                     │
│         │                        │                         ├──1:1──▶ PCS_DETAILS                │
│         │                        │                         ├──1:1──▶ PCS_TEMPERATURE_PRESSURE   │
│         │                        │                         ├──1:M──▶ PCS_PIPE_SIZES             │
│         │                        │                         ├──1:M──▶ PCS_PIPE_ELEMENTS          │
│         │                        │                         ├──1:M──▶ PCS_VALVE_ELEMENTS         │
│         │                        │                         └──1:M──▶ PCS_EMBEDDED_NOTES         │
│         │                        │                                                                │
│         │                        ├────────1:M──────▶┌─────────────────┐                         │
│         │                        │                  │  BOLT_TENSION   │                         │
│         │                        │                  └─────────────────┘                         │
│         │                        │                         │                                     │
│         │                        │                         ├──▶ BOLT_FLANGE_TYPE                │
│         │                        │                         ├──▶ BOLT_GASKET_TYPE                │
│         │                        │                         └──▶ BOLT_TENSION_FORCES             │
│         │                        │                                                                │
│         │                  ┌─────────────┐                                                       │
│         │                  │     VDS     │                                                       │
│         │                  └─────────────┘                                                       │
│         │                         │                                                               │
│         │                         └──1:M──▶ VDS_SUBSEGMENTS                                      │
│         │                                                                                         │
│  ┌──────────────────────────────────────────────────────────────────────────────────────┐       │
│  │                              ETL CONTROL & MONITORING                                 │       │
│  ├──────────────────────────────────────────────────────────────────────────────────────┤       │
│  │  ETL_CONTROL ◄──1:M── ETL_ENDPOINT_LOG                                              │       │
│  │      │                                                                               │       │
│  │      ├──1:M──▶ ETL_VALIDATION_RESULTS                                              │       │
│  │      └──1:M──▶ ETL_AUDIT_LOG                                                       │       │
│  └──────────────────────────────────────────────────────────────────────────────────────┘       │
│                                                                                                    │
└────────────────────────────────────────────────────────────────────────────────────────────────┘
                    </pre>
                </div>
                
                <h3>Entity Group Summary</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Entity Group</th>
                            <th>Number of Tables</th>
                            <th>Primary Purpose</th>
                            <th>Key Relationships</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Master Data</strong></td>
                            <td>2</td>
                            <td>Core reference data for operators and plants</td>
                            <td>OPERATORS → PLANTS (1:M)</td>
                        </tr>
                        <tr>
                            <td><strong>Issues</strong></td>
                            <td>10</td>
                            <td>Issue tracking and all reference types</td>
                            <td>PLANTS → ISSUES (1:M), ISSUES → REFERENCES (1:M)</td>
                        </tr>
                        <tr>
                            <td><strong>PCS</strong></td>
                            <td>8</td>
                            <td>Piping class specifications and details</td>
                            <td>PLANTS → PCS (1:M), PCS → DETAILS (1:M)</td>
                        </tr>
                        <tr>
                            <td><strong>VDS</strong></td>
                            <td>2</td>
                            <td>Valve datasheets and subsegments</td>
                            <td>VDS → SUBSEGMENTS (1:M)</td>
                        </tr>
                        <tr>
                            <td><strong>Bolt Tension</strong></td>
                            <td>3</td>
                            <td>Bolt tension calculations</td>
                            <td>PLANTS → BOLT_TENSION (1:M)</td>
                        </tr>
                        <tr>
                            <td><strong>ETL Control</strong></td>
                            <td>7</td>
                            <td>Process monitoring and data quality</td>
                            <td>ETL_CONTROL → LOGS (1:M)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Operators & Plants Section -->
        <div id="operators-plants" class="content-section">
            <div class="card">
                <h2>Operators & Plants Entity Relationship</h2>
                
                <div class="relationship-flow">
                    <div class="rel-entity">OPERATORS</div>
                    <span class="rel-arrow">→</span>
                    <div class="rel-entity">PLANTS</div>
                    <span class="rel-arrow">→</span>
                    <div class="rel-entity">Multiple Child Entities</div>
                </div>
                
                <h3>STG_OPERATORS Table</h3>
                <div class="table-structure">
                    <table>
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Constraints</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>OPERATOR_ID</strong> <span class="pk-badge">PK</span></td>
                                <td>NUMBER</td>
                                <td>NOT NULL</td>
                                <td>Unique identifier for operator</td>
                            </tr>
                            <tr>
                                <td>OPERATOR_NAME</td>
                                <td>VARCHAR2(200)</td>
                                <td>NOT NULL</td>
                                <td>Name of the operator company</td>
                            </tr>
                            <tr>
                                <td>ETL_RUN_ID</td>
                                <td>NUMBER</td>
                                <td>NOT NULL</td>
                                <td>Reference to ETL execution</td>
                            </tr>
                            <tr>
                                <td><strong>EXTRACTION_DATE</strong> <span class="pk-badge">PK</span></td>
                                <td>TIMESTAMP</td>
                                <td>NOT NULL</td>
                                <td>When data was extracted</td>
                            </tr>
                            <tr>
                                <td>IS_CURRENT</td>
                                <td>CHAR(1)</td>
                                <td>DEFAULT 'Y'</td>
                                <td>Flag for current version</td>
                            </tr>
                            <tr>
                                <td>VALID_FROM</td>
                                <td>TIMESTAMP</td>
                                <td>DEFAULT CURRENT</td>
                                <td>Start of validity period</td>
                            </tr>
                            <tr>
                                <td>VALID_TO</td>
                                <td>TIMESTAMP</td>
                                <td>DEFAULT 9999-12-31</td>
                                <td>End of validity period</td>
                            </tr>
                            <tr>
                                <td>HASH_VALUE</td>
                                <td>VARCHAR2(64)</td>
                                <td>NULL</td>
                                <td>For change detection</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h3>STG_PLANTS Table</h3>
                <div class="table-structure">
                    <table>
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Constraints</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>PLANT_ID</strong> <span class="pk-badge">PK</span></td>
                                <td>VARCHAR2(50)</td>
                                <td>NOT NULL</td>
                                <td>Unique plant identifier (alphanumeric)</td>
                            </tr>
                            <tr>
                                <td>OPERATOR_ID <span class="fk-badge">FK</span></td>
                                <td>NUMBER</td>
                                <td>NULL</td>
                                <td>Reference to operator</td>
                            </tr>
                            <tr>
                                <td>OPERATOR_NAME</td>
                                <td>VARCHAR2(200)</td>
                                <td>NULL</td>
                                <td>Denormalized operator name</td>
                            </tr>
                            <tr>
                                <td>SHORT_DESCRIPTION</td>
                                <td>VARCHAR2(100)</td>
                                <td>NULL</td>
                                <td>Short plant description</td>
                            </tr>
                            <tr>
                                <td>PROJECT</td>
                                <td>VARCHAR2(100)</td>
                                <td>NULL</td>
                                <td>Project name</td>
                            </tr>
                            <tr>
                                <td>LONG_DESCRIPTION</td>
                                <td>VARCHAR2(500)</td>
                                <td>NULL</td>
                                <td>Detailed plant description</td>
                            </tr>
                            <tr>
                                <td>COMMON_LIB_PLANT_CODE</td>
                                <td>VARCHAR2(50)</td>
                                <td>NULL</td>
                                <td>Common library code for plant</td>
                            </tr>
                            <tr>
                                <td>INITIAL_REVISION</td>
                                <td>VARCHAR2(20)</td>
                                <td>NULL</td>
                                <td>Initial revision number</td>
                            </tr>
                            <tr>
                                <td>AREA_ID</td>
                                <td>NUMBER</td>
                                <td>NULL</td>
                                <td>Area identifier</td>
                            </tr>
                            <tr>
                                <td>AREA</td>
                                <td>VARCHAR2(100)</td>
                                <td>NULL</td>
                                <td>Area description</td>
                            </tr>
                            <tr>
                                <td>CATEGORY_ID</td>
                                <td>VARCHAR2(50)</td>
                                <td>NULL</td>
                                <td>Category identifier</td>
                            </tr>
                            <tr>
                                <td>CATEGORY</td>
                                <td>VARCHAR2(100)</td>
                                <td>NULL</td>
                                <td>Category description</td>
                            </tr>
                            <tr>
                                <td>DOCUMENT_SPACE_LINK</td>
                                <td>VARCHAR2(500)</td>
                                <td>NULL</td>
                                <td>Link to document repository</td>
                            </tr>
                            <tr>
                                <td>CELSIUS_BAR</td>
                                <td>VARCHAR2(50)</td>
                                <td>NULL</td>
                                <td>Temperature/pressure units</td>
                            </tr>
                            <tr>
                                <td>BOLT_TENSION_TEXT</td>
                                <td>VARCHAR2(4000)</td>
                                <td>NULL</td>
                                <td>Bolt tension information</td>
                            </tr>
                            <tr>
                                <td><strong>EXTRACTION_DATE</strong> <span class="pk-badge">PK</span></td>
                                <td>TIMESTAMP</td>
                                <td>NOT NULL</td>
                                <td>When data was extracted</td>
                            </tr>
                            <tr>
                                <td>IS_CURRENT</td>
                                <td>CHAR(1)</td>
                                <td>DEFAULT 'Y'</td>
                                <td>Flag for current version</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="alert alert-info">
                    <strong>Key Design Point:</strong> PLANT_ID is VARCHAR2(50) to support both numeric (e.g., "34") and alphanumeric (e.g., "JSV") plant identifiers found in the API.
                </div>
            </div>
        </div>
        
        <!-- Issues Section -->
        <div id="issues" class="content-section">
            <div class="card">
                <h2>Issues & References Entity Relationship</h2>
                
                <div class="erd-container">
                    <pre class="erd-diagram">
                    STG_PLANTS
                        │
                        ├──1:M──▶ STG_ISSUES
                        │              │
                        │              ├──1:M──▶ STG_PCS_REFERENCES
                        │              ├──1:M──▶ STG_SC_REFERENCES
                        │              ├──1:M──▶ STG_VSM_REFERENCES
                        │              ├──1:M──▶ STG_VDS_REFERENCES
                        │              ├──1:M──▶ STG_EDS_REFERENCES
                        │              ├──1:M──▶ STG_MDS_REFERENCES
                        │              ├──1:M──▶ STG_VSK_REFERENCES
                        │              ├──1:M──▶ STG_ESK_REFERENCES
                        │              └──1:M──▶ STG_PIPE_ELEMENT_REFERENCES
                    </pre>
                </div>
                
                <h3>STG_ISSUES Table (Master)</h3>
                <div class="table-structure">
                    <table>
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>PLANT_ID</strong> <span class="pk-badge">PK</span> <span class="fk-badge">FK</span></td>
                                <td>VARCHAR2(50)</td>
                                <td>Reference to plant</td>
                            </tr>
                            <tr>
                                <td><strong>ISSUE_REVISION</strong> <span class="pk-badge">PK</span></td>
                                <td>VARCHAR2(20)</td>
                                <td>Issue revision identifier</td>
                            </tr>
                            <tr>
                                <td>STATUS</td>
                                <td>VARCHAR2(10)</td>
                                <td>Issue status (R/O/H/D)</td>
                            </tr>
                            <tr>
                                <td>REV_DATE</td>
                                <td>VARCHAR2(20)</td>
                                <td>Revision date</td>
                            </tr>
                            <tr>
                                <td>GENERAL_REVISION</td>
                                <td>VARCHAR2(20)</td>
                                <td>General datasheet revision</td>
                            </tr>
                            <tr>
                                <td>PCS_REVISION</td>
                                <td>VARCHAR2(20)</td>
                                <td>PCS revision in this issue</td>
                            </tr>
                            <tr>
                                <td>EDS_REVISION</td>
                                <td>VARCHAR2(20)</td>
                                <td>EDS revision in this issue</td>
                            </tr>
                            <tr>
                                <td>VDS_REVISION</td>
                                <td>VARCHAR2(20)</td>
                                <td>VDS revision in this issue</td>
                            </tr>
                            <tr>
                                <td>MDS_REVISION</td>
                                <td>VARCHAR2(20)</td>
                                <td>MDS revision in this issue</td>
                            </tr>
                            <tr>
                                <td>USER_NAME</td>
                                <td>VARCHAR2(100)</td>
                                <td>API user who made changes</td>
                            </tr>
                            <tr>
                                <td>USER_ENTRY_TIME</td>
                                <td>VARCHAR2(50)</td>
                                <td>When changes were made</td>
                            </tr>
                            <tr>
                                <td><strong>EXTRACTION_DATE</strong> <span class="pk-badge">PK</span></td>
                                <td>TIMESTAMP</td>
                                <td>When data was extracted</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h3>Reference Tables Structure</h3>
                <div class="entity-grid">
                    <div class="entity-box">
                        <div class="entity-header">STG_PCS_REFERENCES</div>
                        <div class="entity-body">
                            <ul class="field-list">
                                <li class="field-item">
                                    <span class="field-name">PLANT_ID <span class="pk-badge">PK</span></span>
                                    <span class="field-type">VARCHAR2(50)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">ISSUE_REVISION <span class="pk-badge">PK</span></span>
                                    <span class="field-type">VARCHAR2(20)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">PCS <span class="pk-badge">PK</span></span>
                                    <span class="field-type">VARCHAR2(100)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">REVISION</span>
                                    <span class="field-type">VARCHAR2(20)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">OFFICIAL_REVISION</span>
                                    <span class="field-type">VARCHAR2(20)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">RATING_CLASS</span>
                                    <span class="field-type">VARCHAR2(50)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">MATERIAL_GROUP</span>
                                    <span class="field-type">VARCHAR2(50)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">DELTA</span>
                                    <span class="field-type">VARCHAR2(10)</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="entity-box">
                        <div class="entity-header">STG_MDS_REFERENCES</div>
                        <div class="entity-body">
                            <ul class="field-list">
                                <li class="field-item">
                                    <span class="field-name">PLANT_ID <span class="pk-badge">PK</span></span>
                                    <span class="field-type">VARCHAR2(50)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">ISSUE_REVISION <span class="pk-badge">PK</span></span>
                                    <span class="field-type">VARCHAR2(20)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">MDS <span class="pk-badge">PK</span></span>
                                    <span class="field-type">VARCHAR2(100)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">REVISION</span>
                                    <span class="field-type">VARCHAR2(20)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">AREA</span>
                                    <span class="field-type">VARCHAR2(100)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">OFFICIAL_REVISION</span>
                                    <span class="field-type">VARCHAR2(20)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">DELTA</span>
                                    <span class="field-type">VARCHAR2(10)</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="entity-box">
                        <div class="entity-header">STG_PIPE_ELEMENT_REFERENCES</div>
                        <div class="entity-body">
                            <ul class="field-list">
                                <li class="field-item">
                                    <span class="field-name">PLANT_ID <span class="pk-badge">PK</span></span>
                                    <span class="field-type">VARCHAR2(50)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">ISSUE_REVISION <span class="pk-badge">PK</span></span>
                                    <span class="field-type">VARCHAR2(20)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">ELEMENT_ID <span class="pk-badge">PK</span></span>
                                    <span class="field-type">NUMBER</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">ELEMENT_GROUP</span>
                                    <span class="field-type">VARCHAR2(100)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">DIMENSION_STANDARD</span>
                                    <span class="field-type">VARCHAR2(100)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">PRODUCT_FORM</span>
                                    <span class="field-type">VARCHAR2(100)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">MATERIAL_GRADE</span>
                                    <span class="field-type">VARCHAR2(100)</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-warning">
                    <strong>Important:</strong> All reference tables include USER_NAME, USER_ENTRY_TIME, and USER_PROTECTED fields from the API header for audit purposes.
                </div>
            </div>
        </div>
        
        <!-- PCS Section -->
        <div id="pcs" class="content-section">
            <div class="card">
                <h2>PCS (Piping Class Specification) Tables</h2>
                
                <div class="erd-container">
                    <pre class="erd-diagram">
                    STG_PLANTS
                        │
                        └──1:M──▶ STG_PCS (Master)
                                    │
                                    ├──1:1──▶ STG_PCS_DETAILS
                                    ├──1:1──▶ STG_PCS_TEMP_PRESSURE
                                    ├──1:M──▶ STG_PCS_PIPE_SIZES
                                    ├──1:M──▶ STG_PCS_PIPE_ELEMENTS
                                    ├──1:M──▶ STG_PCS_VALVE_ELEMENTS
                                    └──1:M──▶ STG_PCS_EMBEDDED_NOTES
                    </pre>
                </div>
                
                <h3>PCS Table Relationships</h3>
                <div class="entity-grid">
                    <div class="entity-box">
                        <div class="entity-header">STG_PCS (Master)</div>
                        <div class="entity-body">
                            <p><strong>Primary Key:</strong></p>
                            <ul>
                                <li>PLANT_ID</li>
                                <li>PCS</li>
                                <li>REVISION</li>
                                <li>EXTRACTION_DATE</li>
                            </ul>
                            <p><strong>Key Fields:</strong></p>
                            <ul>
                                <li>STATUS</li>
                                <li>RATING_CLASS</li>
                                <li>MATERIAL_GROUP</li>
                                <li>DESIGN_CODE</li>
                                <li>TEST_PRESSURE</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="entity-box">
                        <div class="entity-header">STG_PCS_PIPE_SIZES</div>
                        <div class="entity-body">
                            <p><strong>Primary Key:</strong></p>
                            <ul>
                                <li>PLANT_ID</li>
                                <li>PCS</li>
                                <li>REVISION</li>
                                <li>NOM_SIZE</li>
                                <li>EXTRACTION_DATE</li>
                            </ul>
                            <p><strong>Key Fields:</strong></p>
                            <ul>
                                <li>OUTER_DIAM</li>
                                <li>WALL_THICKNESS</li>
                                <li>SCHEDULE</li>
                                <li>CORROSION_ALLOWANCE</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="entity-box">
                        <div class="entity-header">STG_PCS_PIPE_ELEMENTS</div>
                        <div class="entity-body">
                            <p><strong>Primary Key:</strong></p>
                            <ul>
                                <li>PLANT_ID</li>
                                <li>PCS</li>
                                <li>REVISION</li>
                                <li>ELEMENT_ID</li>
                                <li>LINE_NO</li>
                                <li>EXTRACTION_DATE</li>
                            </ul>
                            <p><strong>Key Fields:</strong></p>
                            <ul>
                                <li>ELEMENT</li>
                                <li>DIM_STANDARD</li>
                                <li>MATERIAL</li>
                                <li>MDS/EDS References</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <h3>STG_PCS_DETAILS Structure</h3>
                <div class="alert alert-info">
                    This table contains 40+ fields including design pressures (1-12), design temperatures (1-12), and various revision marks.
                </div>
                <div class="table-structure">
                    <table>
                        <thead>
                            <tr>
                                <th>Field Group</th>
                                <th>Fields</th>
                                <th>Purpose</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Design Pressures</td>
                                <td>DESIGN_PRESS_01 through DESIGN_PRESS_12</td>
                                <td>12 different pressure conditions</td>
                            </tr>
                            <tr>
                                <td>Design Temperatures</td>
                                <td>DESIGN_TEMP_01 through DESIGN_TEMP_12</td>
                                <td>12 different temperature conditions</td>
                            </tr>
                            <tr>
                                <td>Revision Marks</td>
                                <td>*_REV_MARK fields</td>
                                <td>Track changes to specific fields</td>
                            </tr>
                            <tr>
                                <td>Note IDs</td>
                                <td>NOTE_ID_* fields</td>
                                <td>References to embedded notes</td>
                            </tr>
                            <tr>
                                <td>Special Requirements</td>
                                <td>SPECIAL_REQ_ID, SPECIAL_REQ</td>
                                <td>Special requirements text</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- VDS Section -->
        <div id="vds" class="content-section">
            <div class="card">
                <h2>VDS (Valve Datasheet) Tables</h2>
                
                <div class="relationship-flow">
                    <div class="rel-entity">STG_VDS</div>
                    <span class="rel-arrow">→</span>
                    <div class="rel-entity">STG_VDS_SUBSEGMENTS</div>
                </div>
                
                <h3>STG_VDS Table</h3>
                <div class="table-structure">
                    <table>
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>VDS</strong> <span class="pk-badge">PK</span></td>
                                <td>VARCHAR2(100)</td>
                                <td>Valve datasheet identifier</td>
                            </tr>
                            <tr>
                                <td><strong>REVISION</strong> <span class="pk-badge">PK</span></td>
                                <td>VARCHAR2(20)</td>
                                <td>Revision number</td>
                            </tr>
                            <tr>
                                <td>STATUS</td>
                                <td>VARCHAR2(10)</td>
                                <td>VDS status</td>
                            </tr>
                            <tr>
                                <td>DESCRIPTION</td>
                                <td>VARCHAR2(500)</td>
                                <td>VDS description</td>
                            </tr>
                            <tr>
                                <td>VALVE_TYPE_ID</td>
                                <td>NUMBER</td>
                                <td>Type of valve</td>
                            </tr>
                            <tr>
                                <td>RATING_CLASS_ID</td>
                                <td>NUMBER</td>
                                <td>Pressure rating class</td>
                            </tr>
                            <tr>
                                <td>MATERIAL_GROUP_ID</td>
                                <td>NUMBER</td>
                                <td>Material group</td>
                            </tr>
                            <tr>
                                <td>SIZE_RANGE</td>
                                <td>VARCHAR2(100)</td>
                                <td>Applicable size range</td>
                            </tr>
                            <tr>
                                <td>SUBSEGMENT_LIST</td>
                                <td>VARCHAR2(500)</td>
                                <td>List of subsegments</td>
                            </tr>
                            <tr>
                                <td><strong>EXTRACTION_DATE</strong> <span class="pk-badge">PK</span></td>
                                <td>TIMESTAMP</td>
                                <td>When data was extracted</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h3>STG_VDS_SUBSEGMENTS Table</h3>
                <div class="table-structure">
                    <table>
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>VDS</strong> <span class="pk-badge">PK</span> <span class="fk-badge">FK</span></td>
                                <td>VARCHAR2(100)</td>
                                <td>Reference to VDS</td>
                            </tr>
                            <tr>
                                <td><strong>REVISION</strong> <span class="pk-badge">PK</span></td>
                                <td>VARCHAR2(20)</td>
                                <td>VDS revision</td>
                            </tr>
                            <tr>
                                <td><strong>SUBSEGMENT_ID</strong> <span class="pk-badge">PK</span></td>
                                <td>NUMBER</td>
                                <td>Unique subsegment identifier</td>
                            </tr>
                            <tr>
                                <td>SUBSEGMENT_NAME</td>
                                <td>VARCHAR2(200)</td>
                                <td>Name of subsegment</td>
                            </tr>
                            <tr>
                                <td>SEQUENCE</td>
                                <td>NUMBER</td>
                                <td>Display sequence</td>
                            </tr>
                            <tr>
                                <td>MIN_OPERATING_TEMP</td>
                                <td>NUMBER</td>
                                <td>Minimum operating temperature</td>
                            </tr>
                            <tr>
                                <td>MAX_OPERATING_TEMP</td>
                                <td>NUMBER</td>
                                <td>Maximum operating temperature</td>
                            </tr>
                            <tr>
                                <td><strong>EXTRACTION_DATE</strong> <span class="pk-badge">PK</span></td>
                                <td>TIMESTAMP</td>
                                <td>When data was extracted</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="alert alert-info">
                    <strong>Note:</strong> VDS tables are global (not plant-specific) and contain over 44,000 records. Special consideration needed for performance.
                </div>
            </div>
        </div>
        
        <!-- Bolt Tension Section -->
        <div id="bolt" class="content-section">
            <div class="card">
                <h2>Bolt Tension Tables</h2>
                
                <div class="erd-container">
                    <pre class="erd-diagram">
                    STG_PLANTS
                        │
                        └──── STG_BOLT_FLANGE_TYPE
                              STG_BOLT_GASKET_TYPE
                              STG_BOLT_TENSION_FORCES
                    </pre>
                </div>
                
                <h3>Bolt Tension Table Structure</h3>
                <div class="entity-grid">
                    <div class="entity-box">
                        <div class="entity-header">STG_BOLT_FLANGE_TYPE</div>
                        <div class="entity-body">
                            <ul class="field-list">
                                <li class="field-item">
                                    <span class="field-name">PLANT_CODE <span class="pk-badge">PK</span></span>
                                    <span class="field-type">VARCHAR2(20)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">PCS <span class="pk-badge">PK</span></span>
                                    <span class="field-type">VARCHAR2(100)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">FLANGE_SIZE <span class="pk-badge">PK</span></span>
                                    <span class="field-type">NUMBER</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">FLANGE_TYPE_ID</span>
                                    <span class="field-type">NUMBER</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">COMPONENT_TYPE</span>
                                    <span class="field-type">VARCHAR2(100)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">RATING_CLASS</span>
                                    <span class="field-type">VARCHAR2(50)</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="entity-box">
                        <div class="entity-header">STG_BOLT_GASKET_TYPE</div>
                        <div class="entity-body">
                            <ul class="field-list">
                                <li class="field-item">
                                    <span class="field-name">PLANT_CODE <span class="pk-badge">PK</span></span>
                                    <span class="field-type">VARCHAR2(20)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">PCS <span class="pk-badge">PK</span></span>
                                    <span class="field-type">VARCHAR2(100)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">FLANGE_TYPE_ID <span class="pk-badge">PK</span></span>
                                    <span class="field-type">NUMBER</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">FLANGE_SIZE <span class="pk-badge">PK</span></span>
                                    <span class="field-type">NUMBER</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">GASKET_ID</span>
                                    <span class="field-type">NUMBER</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">DISPLAY</span>
                                    <span class="field-type">VARCHAR2(200)</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="entity-box">
                        <div class="entity-header">STG_BOLT_TENSION_FORCES</div>
                        <div class="entity-body">
                            <ul class="field-list">
                                <li class="field-item">
                                    <span class="field-name">PLANT_CODE <span class="pk-badge">PK</span></span>
                                    <span class="field-type">VARCHAR2(20)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">PCS <span class="pk-badge">PK</span></span>
                                    <span class="field-type">VARCHAR2(100)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">NO_OF_BOLTS</span>
                                    <span class="field-type">NUMBER</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">BOLT_DIAMETER</span>
                                    <span class="field-type">VARCHAR2(50)</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">KN</span>
                                    <span class="field-type">NUMBER</span>
                                </li>
                                <li class="field-item">
                                    <span class="field-name">NM</span>
                                    <span class="field-type">NUMBER</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-warning">
                    <strong>Note:</strong> Bolt tension tables use PLANT_CODE (derived from CommonLibPlantCode) instead of PLANT_ID for API compatibility.
                </div>
            </div>
        </div>
        
        <!-- ETL Control Section -->
        <div id="etl-control" class="content-section">
            <div class="card">
                <h2>ETL Control & Monitoring Tables</h2>
                
                <div class="erd-container">
                    <pre class="erd-diagram">
                    ETL_CONTROL (Master)
                        │
                        ├──1:M──▶ ETL_ENDPOINT_LOG
                        ├──1:M──▶ ETL_VALIDATION_RESULTS
                        └──1:M──▶ ETL_AUDIT_LOG
                    
                    ETL_VALIDATION_RULES ──1:M──▶ ETL_VALIDATION_RESULTS
                    </pre>
                </div>
                
                <h3>ETL_CONTROL Table</h3>
                <div class="table-structure">
                    <table>
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>ETL_RUN_ID</strong> <span class="pk-badge">PK</span></td>
                                <td>NUMBER (IDENTITY)</td>
                                <td>Auto-generated run identifier</td>
                            </tr>
                            <tr>
                                <td>RUN_DATE</td>
                                <td>TIMESTAMP</td>
                                <td>When ETL started</td>
                            </tr>
                            <tr>
                                <td>RUN_TYPE</td>
                                <td>VARCHAR2(20)</td>
                                <td>FULL/INCREMENTAL/DELTA</td>
                            </tr>
                            <tr>
                                <td>STATUS</td>
                                <td>VARCHAR2(20)</td>
                                <td>RUNNING/SUCCESS/FAILED</td>
                            </tr>
                            <tr>
                                <td>RECORDS_EXTRACTED</td>
                                <td>NUMBER</td>
                                <td>Total records from API</td>
                            </tr>
                            <tr>
                                <td>RECORDS_LOADED</td>
                                <td>NUMBER</td>
                                <td>Records loaded to DB</td>
                            </tr>
                            <tr>
                                <td>ERROR_COUNT</td>
                                <td>NUMBER</td>
                                <td>Number of errors</td>
                            </tr>
                            <tr>
                                <td>DURATION_SECONDS</td>
                                <td>NUMBER (VIRTUAL)</td>
                                <td>Calculated duration</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h3>ETL Monitoring Tables</h3>
                <div class="entity-grid">
                    <div class="entity-box">
                        <div class="entity-header">ETL_ENDPOINT_LOG</div>
                        <div class="entity-body">
                            <p><strong>Purpose:</strong> Track each API endpoint call</p>
                            <p><strong>Key Fields:</strong></p>
                            <ul>
                                <li>ENDPOINT_NAME</li>
                                <li>API_URL</li>
                                <li>RESPONSE_TIME_MS</li>
                                <li>RECORD_COUNT</li>
                                <li>ERROR_MESSAGE</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="entity-box">
                        <div class="entity-header">ETL_VALIDATION_RULES</div>
                        <div class="entity-body">
                            <p><strong>Purpose:</strong> Define data quality rules</p>
                            <p><strong>Rule Types:</strong></p>
                            <ul>
                                <li>NOT_NULL</li>
                                <li>UNIQUE</li>
                                <li>RANGE</li>
                                <li>REGEX</li>
                                <li>REFERENTIAL</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="entity-box">
                        <div class="entity-header">ETL_AUDIT_LOG</div>
                        <div class="entity-body">
                            <p><strong>Purpose:</strong> Audit trail of all operations</p>
                            <p><strong>Key Fields:</strong></p>
                            <ul>
                                <li>ACTION_TYPE</li>
                                <li>TABLE_NAME</li>
                                <li>OPERATION</li>
                                <li>USER_NAME</li>
                                <li>IP_ADDRESS</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Relationships Section -->
        <div id="relationships" class="content-section">
            <div class="card">
                <h2>Key Relationships & Cardinality</h2>
                
                <h3>Primary Relationships</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Parent Table</th>
                            <th>Relationship</th>
                            <th>Child Table</th>
                            <th>Join Condition</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>STG_OPERATORS</td>
                            <td>1:M</td>
                            <td>STG_PLANTS</td>
                            <td>OPERATOR_ID</td>
                        </tr>
                        <tr>
                            <td>STG_PLANTS</td>
                            <td>1:M</td>
                            <td>STG_ISSUES</td>
                            <td>PLANT_ID</td>
                        </tr>
                        <tr>
                            <td>STG_PLANTS</td>
                            <td>1:M</td>
                            <td>STG_PCS</td>
                            <td>PLANT_ID</td>
                        </tr>
                        <tr>
                            <td>STG_ISSUES</td>
                            <td>1:M</td>
                            <td>STG_PCS_REFERENCES</td>
                            <td>PLANT_ID + ISSUE_REVISION</td>
                        </tr>
                        <tr>
                            <td>STG_PCS</td>
                            <td>1:1</td>
                            <td>STG_PCS_DETAILS</td>
                            <td>PLANT_ID + PCS + REVISION</td>
                        </tr>
                        <tr>
                            <td>STG_PCS</td>
                            <td>1:M</td>
                            <td>STG_PCS_PIPE_SIZES</td>
                            <td>PLANT_ID + PCS + REVISION</td>
                        </tr>
                        <tr>
                            <td>STG_VDS</td>
                            <td>1:M</td>
                            <td>STG_VDS_SUBSEGMENTS</td>
                            <td>VDS + REVISION</td>
                        </tr>
                        <tr>
                            <td>ETL_CONTROL</td>
                            <td>1:M</td>
                            <td>ETL_ENDPOINT_LOG</td>
                            <td>ETL_RUN_ID</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3>Foreign Key Constraints</h3>
                <div class="alert alert-info">
                    <strong>Design Decision:</strong> Foreign keys are logically defined but may not be physically implemented to allow for:
                    <ul>
                        <li>Parallel loading of tables</li>
                        <li>Historical data retention</li>
                        <li>Partial data loads during testing</li>
                    </ul>
                    Data integrity is enforced through ETL validation rules instead.
                </div>
                
                <h3>Temporal Relationships</h3>
                <div class="sql-code">
-- Query current data with relationships
SELECT 
    p.PLANT_ID,
    p.LONG_DESCRIPTION,
    i.ISSUE_REVISION,
    i.STATUS
FROM STG_PLANTS p
JOIN STG_ISSUES i ON p.PLANT_ID = i.PLANT_ID
WHERE p.IS_CURRENT = 'Y'
  AND i.IS_CURRENT = 'Y';

-- Query historical data
SELECT 
    p.PLANT_ID,
    p.LONG_DESCRIPTION,
    p.EXTRACTION_DATE,
    p.VALID_FROM,
    p.VALID_TO
FROM STG_PLANTS p
WHERE p.PLANT_ID = '34'
ORDER BY p.EXTRACTION_DATE DESC;
                </div>
            </div>
        </div>
        
        <!-- SQL Examples Section -->
        <div id="sql-samples" class="content-section">
            <div class="card">
                <h2>SQL Query Examples</h2>
                
                <h3>1. Get Current Plant with All Issues</h3>
                <div class="sql-code">
SELECT 
    p.PLANT_ID,
    p.LONG_DESCRIPTION,
    p.OPERATOR_NAME,
    i.ISSUE_REVISION,
    i.STATUS,
    i.REV_DATE,
    i.PCS_REVISION,
    i.USER_NAME,
    i.USER_ENTRY_TIME
FROM STG_PLANTS p
LEFT JOIN STG_ISSUES i 
    ON p.PLANT_ID = i.PLANT_ID 
    AND i.IS_CURRENT = 'Y'
WHERE p.IS_CURRENT = 'Y'
  AND p.PLANT_ID = '34'
ORDER BY i.ISSUE_REVISION;
                </div>
                
                <h3>2. Get PCS with All Details</h3>
                <div class="sql-code">
SELECT 
    pcs.PLANT_ID,
    pcs.PCS,
    pcs.REVISION,
    pcs.STATUS,
    pcs.RATING_CLASS,
    pcs.MATERIAL_GROUP,
    COUNT(DISTINCT ps.NOM_SIZE) AS PIPE_SIZES,
    COUNT(DISTINCT pe.ELEMENT_ID) AS PIPE_ELEMENTS,
    COUNT(DISTINCT ve.LINE_NO) AS VALVE_ELEMENTS
FROM STG_PCS pcs
LEFT JOIN STG_PCS_PIPE_SIZES ps 
    ON pcs.PLANT_ID = ps.PLANT_ID 
    AND pcs.PCS = ps.PCS 
    AND pcs.REVISION = ps.REVISION
LEFT JOIN STG_PCS_PIPE_ELEMENTS pe 
    ON pcs.PLANT_ID = pe.PLANT_ID 
    AND pcs.PCS = pe.PCS 
    AND pcs.REVISION = pe.REVISION
LEFT JOIN STG_PCS_VALVE_ELEMENTS ve 
    ON pcs.PLANT_ID = ve.PLANT_ID 
    AND pcs.PCS = ve.PCS 
    AND pcs.REVISION = ve.REVISION
WHERE pcs.IS_CURRENT = 'Y'
  AND pcs.PLANT_ID = '34'
GROUP BY pcs.PLANT_ID, pcs.PCS, pcs.REVISION, 
         pcs.STATUS, pcs.RATING_CLASS, pcs.MATERIAL_GROUP;
                </div>
                
                <h3>3. Track Changes Over Time (SCD Type 2)</h3>
                <div class="sql-code">
-- Find all changes to a specific plant
SELECT 
    PLANT_ID,
    LONG_DESCRIPTION,
    EXTRACTION_DATE,
    IS_CURRENT,
    VALID_FROM,
    VALID_TO,
    HASH_VALUE
FROM STG_PLANTS
WHERE PLANT_ID = '34'
ORDER BY EXTRACTION_DATE DESC;

-- Get point-in-time view
SELECT *
FROM STG_PLANTS
WHERE PLANT_ID = '34'
  AND TO_DATE('2025-01-15', 'YYYY-MM-DD') 
      BETWEEN VALID_FROM AND VALID_TO;
                </div>
                
                <h3>4. ETL Monitoring Queries</h3>
                <div class="sql-code">
-- Recent ETL runs summary
SELECT 
    ETL_RUN_ID,
    RUN_DATE,
    RUN_TYPE,
    STATUS,
    RECORDS_EXTRACTED,
    RECORDS_LOADED,
    ERROR_COUNT,
    ROUND(DURATION_SECONDS / 60, 2) AS DURATION_MINUTES
FROM ETL_CONTROL
ORDER BY ETL_RUN_ID DESC
FETCH FIRST 10 ROWS ONLY;

-- Endpoint performance analysis
SELECT 
    el.ENDPOINT_NAME,
    COUNT(*) AS CALLS,
    AVG(el.RESPONSE_TIME_MS) AS AVG_MS,
    MAX(el.RESPONSE_TIME_MS) AS MAX_MS,
    SUM(el.RECORD_COUNT) AS TOTAL_RECORDS,
    SUM(CASE WHEN el.STATUS = 'ERROR' THEN 1 ELSE 0 END) AS ERRORS
FROM ETL_ENDPOINT_LOG el
JOIN ETL_CONTROL ec ON el.ETL_RUN_ID = ec.ETL_RUN_ID
WHERE ec.RUN_DATE >= SYSDATE - 7
GROUP BY el.ENDPOINT_NAME
ORDER BY AVG_MS DESC;
                </div>
                
                <h3>5. Data Quality Validation</h3>
                <div class="sql-code">
-- Check for orphaned records
SELECT 'Orphaned Issues' AS CHECK_TYPE,
       COUNT(*) AS COUNT
FROM STG_ISSUES i
WHERE IS_CURRENT = 'Y'
  AND NOT EXISTS (
    SELECT 1 FROM STG_PLANTS p 
    WHERE p.PLANT_ID = i.PLANT_ID 
    AND p.IS_CURRENT = 'Y'
  )
UNION ALL
SELECT 'Invalid Dates' AS CHECK_TYPE,
       COUNT(*) AS COUNT
FROM STG_ISSUES
WHERE IS_CURRENT = 'Y'
  AND NOT REGEXP_LIKE(REV_DATE, '^\d{2}\.\d{2}\.\d{4}$')
UNION ALL
SELECT 'Invalid Status' AS CHECK_TYPE,
       COUNT(*) AS COUNT
FROM STG_PCS
WHERE IS_CURRENT = 'Y'
  AND STATUS NOT IN ('R', 'O', 'H', 'D');
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function showTab(tabName) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(tabName).classList.add('active');
            
            // Mark selected tab as active
            event.target.classList.add('active');
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
        
        // Print functionality
        function printERD() {
            window.print();
        }
    </script>
</body>
</html>