@page "/user-guide"
@using TR2KBlazorLibrary.Models

<PageTitle>User Guide - TR2000 API Data Manager</PageTitle>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <!-- Header -->
            <div class="card mb-4" style="background-color: #00346a; color: white;">
                <div class="card-header text-center">
                    <h3 class="mb-0"><i class="bi bi-book me-2"></i>TR2000 API Data Manager - User Guide</h3>
                </div>
            </div>

            <!-- Table of Contents -->
            <div class="card mb-4">
                <div class="card-header" style="background-color: #00346a; color: white;">
                    <h5 class="mb-0"><i class="bi bi-list me-2"></i>Table of Contents</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li><a href="#overview" class="text-decoration-none">1. Application Overview</a></li>
                                <li><a href="#architecture" class="text-decoration-none">2. System Architecture</a></li>
                                <li><a href="#erd" class="text-decoration-none">3. Entity Relationship Diagram</a></li>
                                <li><a href="#flow-chart" class="text-decoration-none">4. ETL Process Flow</a></li>
                                <li><a href="#etl-operations" class="text-decoration-none">5. ETL Operations Guide</a></li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li><a href="#master-data" class="text-decoration-none">6. Master Data Management</a></li>
                                <li><a href="#reference-data" class="text-decoration-none">7. Reference Data Management</a></li>
                                <li><a href="#troubleshooting" class="text-decoration-none">8. Troubleshooting</a></li>
                                <li><a href="#best-practices" class="text-decoration-none">9. Best Practices</a></li>
                                <li><a href="#technical-details" class="text-decoration-none">10. Technical Details</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 1. Application Overview -->
            <div class="card mb-4" id="overview">
                <div class="card-header" style="background-color: #00346a; color: white;">
                    <h5 class="mb-0">1. Application Overview</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h6>What is TR2000 API Data Manager?</h6>
                            <p>The TR2000 API Data Manager is a comprehensive Extract, Transform, Load (ETL) system designed to efficiently manage piping specification data from the TR2000 API. It provides a centralized platform for data ingestion, processing, and storage with full audit trails and data integrity controls.</p>
                            
                            <h6>Key Features:</h6>
                            <ul>
                                <li><strong>70% API Call Reduction:</strong> Smart scope control using Plant and Issue Loaders</li>
                                <li><strong>Complete SCD2 Implementation:</strong> Full historical tracking with INSERT, UPDATE, DELETE, REACTIVATE</li>
                                <li><strong>Cascade Deletion:</strong> Automatic data integrity maintenance</li>
                                <li><strong>Oracle-Centric Architecture:</strong> All business logic in database packages</li>
                                <li><strong>Production Ready:</strong> Atomic transactions, error handling, and audit trails</li>
                                <li><strong>Real-time Monitoring:</strong> Performance metrics and ETL history tracking</li>
                            </ul>
                        </div>
                        <div class="col-md-4">
                            <div class="alert alert-info">
                                <h6><i class="bi bi-info-circle me-2"></i>Quick Stats</h6>
                                <ul class="list-unstyled small">
                                    <li><strong>Database:</strong> Oracle 21c XE</li>
                                    <li><strong>Framework:</strong> .NET 9.0 Blazor Server</li>
                                    <li><strong>API Source:</strong> TR2000 Equinor API</li>
                                    <li><strong>Tables:</strong> 50+ staging and dimension tables</li>
                                    <li><strong>Reference Types:</strong> 6 (VDS, EDS, MDS, VSK, ESK, Pipe Element)</li>
                                    <li><strong>Master Entities:</strong> Operators, Plants, Issues</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2. System Architecture -->
            <div class="card mb-4" id="architecture">
                <div class="card-header" style="background-color: #00346a; color: white;">
                    <h5 class="mb-0">2. System Architecture</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Oracle-Centric Design</h6>
                            <p>The system follows an Oracle-centric architecture where the database contains all business logic, ensuring consistency and performance.</p>
                            
                            <h6>C# Application Responsibilities:</h6>
                            <ul>
                                <li>Fetch data from TR2000 API</li>
                                <li>Insert raw data into staging tables</li>
                                <li>Call Oracle stored procedures</li>
                                <li>Return status and metrics to UI</li>
                            </ul>
                            
                            <h6>Oracle Database Responsibilities:</h6>
                            <ul>
                                <li>Data deduplication and validation</li>
                                <li>SCD2 temporal logic implementation</li>
                                <li>Error handling and autonomous logging</li>
                                <li>Audit trail maintenance</li>
                                <li>Data reconciliation and integrity checks</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-success">
                                <h6><i class="bi bi-shield-check me-2"></i>Data Integrity Features</h6>
                                <ul class="list-unstyled small">
                                    <li><strong>Atomic Transactions:</strong> Single COMMIT in orchestrator</li>
                                    <li><strong>Autonomous Error Logging:</strong> Survives rollbacks</li>
                                    <li><strong>Hash-based Change Detection:</strong> Oracle STANDARD_HASH</li>
                                    <li><strong>Deterministic Deduplication:</strong> ROW_NUMBER with STG_ID</li>
                                    <li><strong>Cascade Deletion:</strong> Maintains referential integrity</li>
                                    <li><strong>RAW_JSON Audit:</strong> 30-day retention with compression</li>
                                </ul>
                            </div>
                            
                            <div class="alert alert-warning">
                                <h6><i class="bi bi-lightning me-2"></i>Performance Optimizations</h6>
                                <ul class="list-unstyled small">
                                    <li><strong>Plant Loader:</strong> Process only selected plants</li>
                                    <li><strong>Issue Loader:</strong> 70% reduction in API calls</li>
                                    <li><strong>Set-based Operations:</strong> No row-by-row processing</li>
                                    <li><strong>Partial Indexes:</strong> Optimized for IS_CURRENT queries</li>
                                    <li><strong>Bulk Operations:</strong> Efficient data movement</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. Entity Relationship Diagram -->
            <div class="card mb-4" id="erd">
                <div class="card-header" style="background-color: #00346a; color: white;">
                    <h5 class="mb-0">3. Entity Relationship Diagram</h5>
                </div>
                <div class="card-body">
                    <div class="text-center mb-3">
                        <h6>TR2000 Enhanced Database Schema Overview</h6>
                        <p class="text-muted">Complete field coverage with 24+ PLANTS fields, 25+ ISSUES fields, and 4 new PCS engineering tables</p>
                        <div class="alert alert-success">
                            <strong>Session 20 Enhancement:</strong> 100% API field coverage vs. previous 20% minimal implementation
                        </div>
                    </div>
                    
                    <!-- ERD Visualization -->
                    <div class="border rounded p-3" style="background-color: #f8f9fa; min-height: 600px;">
                        <svg width="100%" height="600" viewBox="0 0 1200 600">
                            <!-- Control Tables Section -->
                            <g id="control-tables">
                                <text x="60" y="25" class="fw-bold" fill="#00346a">Control & Configuration Tables</text>
                                
                                <!-- ETL_CONTROL -->
                                <rect x="10" y="35" width="120" height="80" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
                                <text x="70" y="50" text-anchor="middle" class="fw-bold" font-size="12">ETL_CONTROL</text>
                                <text x="15" y="65" font-size="10">ETL_RUN_ID (PK)</text>
                                <text x="15" y="78" font-size="10">RUN_TYPE</text>
                                <text x="15" y="91" font-size="10">STATUS</text>
                                <text x="15" y="104" font-size="10">START_TIME</text>
                                
                                <!-- ETL_PLANT_LOADER -->
                                <rect x="150" y="35" width="120" height="80" fill="#e8f5e8" stroke="#388e3c" stroke-width="2"/>
                                <text x="210" y="50" text-anchor="middle" class="fw-bold" font-size="12">ETL_PLANT_LOADER</text>
                                <text x="155" y="65" font-size="10">PLANT_ID (PK)</text>
                                <text x="155" y="78" font-size="10">PLANT_NAME</text>
                                <text x="155" y="91" font-size="10">IS_ACTIVE</text>
                                <text x="155" y="104" font-size="10">CREATED_DATE</text>
                                
                                <!-- ETL_ISSUE_LOADER -->
                                <rect x="290" y="35" width="120" height="80" fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
                                <text x="350" y="50" text-anchor="middle" class="fw-bold" font-size="12">ETL_ISSUE_LOADER</text>
                                <text x="295" y="65" font-size="10">PLANT_ID (PK)</text>
                                <text x="295" y="78" font-size="10">ISSUE_REVISION (PK)</text>
                                <text x="295" y="91" font-size="10">PLANT_NAME</text>
                                <text x="295" y="104" font-size="10">CREATED_DATE</text>
                            </g>
                            
                            <!-- Master Data Section -->
                            <g id="master-data">
                                <text x="60" y="165" class="fw-bold" fill="#00346a">Master Data Tables (SCD2)</text>
                                
                                <!-- OPERATORS -->
                                <rect x="10" y="175" width="120" height="100" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
                                <text x="70" y="190" text-anchor="middle" class="fw-bold" font-size="12">OPERATORS</text>
                                <text x="15" y="205" font-size="10">OPERATOR_ID (PK)</text>
                                <text x="15" y="218" font-size="10">VALID_FROM (PK)</text>
                                <text x="15" y="231" font-size="10">OPERATOR_NAME</text>
                                <text x="15" y="244" font-size="10">IS_CURRENT</text>
                                <text x="15" y="257" font-size="10">CHANGE_TYPE</text>
                                <text x="15" y="270" font-size="10">SRC_HASH</text>
                                
                                <!-- PLANTS -->
                                <rect x="150" y="175" width="120" height="100" fill="#e1f5fe" stroke="#0277bd" stroke-width="2"/>
                                <text x="210" y="190" text-anchor="middle" class="fw-bold" font-size="12">PLANTS</text>
                                <text x="155" y="205" font-size="9">PLANT_ID (PK) +24 fields</text>
                                <text x="155" y="218" font-size="9">VALID_FROM (PK)</text>
                                <text x="155" y="231" font-size="9">PROJECT, AREA, CATEGORY</text>
                                <text x="155" y="244" font-size="9">PCS_QA, EDS_MJ, CELSIUS_BAR</text>
                                <text x="155" y="257" font-size="9">WEB_INFO_TEXT, BOLT_TENSION</text>
                                <text x="155" y="270" font-size="9">ENHANCED FIELD COVERAGE</text>
                                
                                <!-- ISSUES -->
                                <rect x="290" y="175" width="120" height="100" fill="#fce4ec" stroke="#c2185b" stroke-width="2"/>
                                <text x="350" y="190" text-anchor="middle" class="fw-bold" font-size="12">ISSUES</text>
                                <text x="295" y="205" font-size="9">PLANT_ID (PK) +25 fields</text>
                                <text x="295" y="218" font-size="9">ISSUE_REVISION (PK)</text>
                                <text x="295" y="231" font-size="9">STATUS, REV_DATE</text>
                                <text x="295" y="244" font-size="9">PCS/EDS/VDS/VSK_REVISION</text>
                                <text x="295" y="257" font-size="9">COMPLETE REVISION MATRIX</text>
                                <text x="295" y="270" font-size="9">ENHANCED TRACKING</text>
                            </g>
                            
                            <!-- Reference Data Section -->
                            <g id="reference-data">
                                <text x="480" y="25" class="fw-bold" fill="#00346a">Reference Data Tables (SCD2)</text>
                                
                                <!-- VDS_REFERENCES -->
                                <rect x="430" y="35" width="120" height="100" fill="#e8f5e8" stroke="#2e7d32" stroke-width="2"/>
                                <text x="490" y="50" text-anchor="middle" class="fw-bold" font-size="12">VDS_REFERENCES</text>
                                <text x="435" y="65" font-size="9">PLANT_ID (PK) Enhanced</text>
                                <text x="435" y="78" font-size="9">VDS_NAME, VDS_REVISION</text>
                                <text x="435" y="91" font-size="9">REV_DATE, STATUS</text>
                                <text x="435" y="104" font-size="9">OFFICIAL_REVISION, DELTA</text>
                                <text x="435" y="117" font-size="9">COMPLETE METADATA</text>
                                <text x="435" y="130" font-size="9">SCD2 TRACKING</text>
                                
                                <!-- EDS_REFERENCES -->
                                <rect x="570" y="35" width="120" height="100" fill="#fff8e1" stroke="#f9a825" stroke-width="2"/>
                                <text x="630" y="50" text-anchor="middle" class="fw-bold" font-size="12">EDS_REFERENCES</text>
                                <text x="575" y="65" font-size="9">Enhanced with Metadata</text>
                                <text x="575" y="78" font-size="9">REV_DATE, STATUS</text>
                                <text x="575" y="91" font-size="9">OFFICIAL_REVISION</text>
                                <text x="575" y="104" font-size="9">Complete SCD2</text>
                                <text x="575" y="117" font-size="9">All 5 Reference Types</text>
                                <text x="575" y="130" font-size="9">Enhanced Coverage</text>
                                
                                <!-- NEW PCS ENGINEERING TABLES -->
                                <rect x="710" y="35" width="120" height="100" fill="#ffcccb" stroke="#d32f2f" stroke-width="3"/>
                                <text x="770" y="50" text-anchor="middle" class="fw-bold" font-size="12">NEW: PCS TABLES</text>
                                <text x="715" y="65" font-size="9">PCS_HEADER (15+ fields)</text>
                                <text x="715" y="78" font-size="9">PCS_TEMP_PRESSURE (50+ fields)</text>
                                <text x="715" y="91" font-size="9">PCS_PIPE_SIZES (11 fields)</text>
                                <text x="715" y="104" font-size="9">PCS_PIPE_ELEMENTS (25+ fields)</text>
                                <text x="715" y="117" font-size="9">100+ ENGINEERING FIELDS</text>
                                <text x="715" y="130" font-size="9">COMPLETE COVERAGE</text>
                                
                                <!-- VSK_REFERENCES -->
                                <rect x="430" y="155" width="120" height="100" fill="#e3f2fd" stroke="#1565c0" stroke-width="2"/>
                                <text x="490" y="170" text-anchor="middle" class="fw-bold" font-size="12">VSK_REFERENCES</text>
                                <text x="435" y="185" font-size="10">PLANT_ID (PK)</text>
                                <text x="435" y="198" font-size="10">ISSUE_REVISION (PK)</text>
                                <text x="435" y="211" font-size="10">VSK_NAME (PK)</text>
                                <text x="435" y="224" font-size="10">VSK_REVISION (PK)</text>
                                <text x="435" y="237" font-size="10">VALID_FROM (PK)</text>
                                <text x="435" y="250" font-size="10">IS_CURRENT</text>
                                
                                <!-- ESK_REFERENCES -->
                                <rect x="570" y="155" width="120" height="100" fill="#f3e5f5" stroke="#8e24aa" stroke-width="2"/>
                                <text x="630" y="170" text-anchor="middle" class="fw-bold" font-size="12">ESK_REFERENCES</text>
                                <text x="575" y="185" font-size="10">PLANT_ID (PK)</text>
                                <text x="575" y="198" font-size="10">ISSUE_REVISION (PK)</text>
                                <text x="575" y="211" font-size="10">ESK_NAME (PK)</text>
                                <text x="575" y="224" font-size="10">ESK_REVISION (PK)</text>
                                <text x="575" y="237" font-size="10">VALID_FROM (PK)</text>
                                <text x="575" y="250" font-size="10">IS_CURRENT</text>
                                
                                <!-- PIPE_ELEMENT_REFERENCES -->
                                <rect x="710" y="155" width="120" height="100" fill="#e0f2f1" stroke="#00695c" stroke-width="2"/>
                                <text x="770" y="170" text-anchor="middle" class="fw-bold" font-size="12">PIPE_ELEMENT_REF</text>
                                <text x="715" y="185" font-size="10">PLANT_ID (PK)</text>
                                <text x="715" y="198" font-size="10">ISSUE_REVISION (PK)</text>
                                <text x="715" y="211" font-size="10">TAG_NO (PK)</text>
                                <text x="715" y="224" font-size="10">ELEMENT_TYPE</text>
                                <text x="715" y="237" font-size="10">VALID_FROM (PK)</text>
                                <text x="715" y="250" font-size="10">IS_CURRENT</text>
                            </g>
                            
                            <!-- Staging Tables Section -->
                            <g id="staging-tables">
                                <text x="60" y="325" class="fw-bold" fill="#00346a">Staging Tables (with Deduplication)</text>
                                
                                <!-- STG_OPERATORS -->
                                <rect x="10" y="335" width="120" height="80" fill="#f5f5f5" stroke="#757575" stroke-width="1" stroke-dasharray="5,5"/>
                                <text x="70" y="350" text-anchor="middle" class="fw-bold" font-size="12">STG_OPERATORS</text>
                                <text x="15" y="365" font-size="10">STG_ID (PK)</text>
                                <text x="15" y="378" font-size="10">OPERATOR_ID</text>
                                <text x="15" y="391" font-size="10">IS_DUPLICATE</text>
                                <text x="15" y="404" font-size="10">IS_VALID</text>
                                
                                <!-- STG_PLANTS -->
                                <rect x="150" y="335" width="120" height="80" fill="#f5f5f5" stroke="#757575" stroke-width="1" stroke-dasharray="5,5"/>
                                <text x="210" y="350" text-anchor="middle" class="fw-bold" font-size="12">STG_PLANTS</text>
                                <text x="155" y="365" font-size="10">STG_ID (PK)</text>
                                <text x="155" y="378" font-size="10">PLANT_ID</text>
                                <text x="155" y="391" font-size="10">IS_DUPLICATE</text>
                                <text x="155" y="404" font-size="10">IS_VALID</text>
                                
                                <!-- STG_ISSUES -->
                                <rect x="290" y="335" width="120" height="80" fill="#f5f5f5" stroke="#757575" stroke-width="1" stroke-dasharray="5,5"/>
                                <text x="350" y="350" text-anchor="middle" class="fw-bold" font-size="12">STG_ISSUES</text>
                                <text x="295" y="365" font-size="10">STG_ID (PK)</text>
                                <text x="295" y="378" font-size="10">PLANT_ID</text>
                                <text x="295" y="391" font-size="10">ISSUE_REVISION</text>
                                <text x="295" y="404" font-size="10">IS_DUPLICATE</text>
                                
                                <!-- STG_*_REFERENCES (representative) -->
                                <rect x="430" y="335" width="120" height="80" fill="#f5f5f5" stroke="#757575" stroke-width="1" stroke-dasharray="5,5"/>
                                <text x="490" y="350" text-anchor="middle" class="fw-bold" font-size="12">STG_*_REFERENCES</text>
                                <text x="435" y="365" font-size="10">STG_ID (PK)</text>
                                <text x="435" y="378" font-size="10">PLANT_ID</text>
                                <text x="435" y="391" font-size="10">ISSUE_REVISION</text>
                                <text x="435" y="404" font-size="10">IS_DUPLICATE</text>
                            </g>
                            
                            <!-- Audit & Error Tables -->
                            <g id="audit-tables">
                                <text x="60" y="465" class="fw-bold" fill="#00346a">Audit & Error Tracking</text>
                                
                                <!-- ETL_ERROR_LOG -->
                                <rect x="10" y="475" width="120" height="80" fill="#ffebee" stroke="#d32f2f" stroke-width="2"/>
                                <text x="70" y="490" text-anchor="middle" class="fw-bold" font-size="12">ETL_ERROR_LOG</text>
                                <text x="15" y="505" font-size="10">ERROR_ID (PK)</text>
                                <text x="15" y="518" font-size="10">ETL_RUN_ID</text>
                                <text x="15" y="531" font-size="10">ERROR_SOURCE</text>
                                <text x="15" y="544" font-size="10">ERROR_MESSAGE</text>
                                
                                <!-- RAW_JSON -->
                                <rect x="150" y="475" width="120" height="80" fill="#e8f5e8" stroke="#388e3c" stroke-width="2"/>
                                <text x="210" y="490" text-anchor="middle" class="fw-bold" font-size="12">RAW_JSON</text>
                                <text x="155" y="505" font-size="10">ID (PK)</text>
                                <text x="155" y="518" font-size="10">ENDPOINT</text>
                                <text x="155" y="531" font-size="10">PAYLOAD (CLOB)</text>
                                <text x="155" y="544" font-size="10">LOAD_TS</text>
                                
                                <!-- ETL_RECONCILIATION -->
                                <rect x="290" y="475" width="120" height="80" fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
                                <text x="350" y="490" text-anchor="middle" class="fw-bold" font-size="12">ETL_RECONCILIATION</text>
                                <text x="295" y="505" font-size="10">ETL_RUN_ID (PK)</text>
                                <text x="295" y="518" font-size="10">ENTITY_TYPE (PK)</text>
                                <text x="295" y="531" font-size="10">SOURCE_COUNT</text>
                                <text x="295" y="544" font-size="10">TARGET_COUNT</text>
                            </g>
                            
                            <!-- Relationships -->
                            <!-- Plant Loader to Issue Loader -->
                            <line x1="270" y1="75" x2="290" y2="75" stroke="#00346a" stroke-width="2" marker-end="url(#arrowhead)"/>
                            
                            <!-- Operators to Plants -->
                            <line x1="130" y1="225" x2="150" y2="225" stroke="#00346a" stroke-width="2" marker-end="url(#arrowhead)"/>
                            
                            <!-- Plants to Issues -->
                            <line x1="270" y1="225" x2="290" y2="225" stroke="#00346a" stroke-width="2" marker-end="url(#arrowhead)"/>
                            
                            <!-- Issues to Reference Tables -->
                            <line x1="410" y1="225" x2="430" y2="95" stroke="#666" stroke-width="1" marker-end="url(#arrowhead)"/>
                            <line x1="410" y1="225" x2="570" y2="95" stroke="#666" stroke-width="1" marker-end="url(#arrowhead)"/>
                            <line x1="410" y1="225" x2="710" y2="95" stroke="#666" stroke-width="1" marker-end="url(#arrowhead)"/>
                            <line x1="410" y1="225" x2="430" y2="205" stroke="#666" stroke-width="1" marker-end="url(#arrowhead)"/>
                            <line x1="410" y1="225" x2="570" y2="205" stroke="#666" stroke-width="1" marker-end="url(#arrowhead)"/>
                            <line x1="410" y1="225" x2="710" y2="205" stroke="#666" stroke-width="1" marker-end="url(#arrowhead)"/>
                            
                            <!-- Staging to Dimension (representative lines) -->
                            <line x1="70" y1="335" x2="70" y2="275" stroke="#999" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
                            <line x1="210" y1="335" x2="210" y2="275" stroke="#999" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
                            <line x1="350" y1="335" x2="350" y2="275" stroke="#999" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
                            
                            <!-- Arrow marker definition -->
                            <defs>
                                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                                    <polygon points="0 0, 10 3.5, 0 7" fill="#00346a"/>
                                </marker>
                            </defs>
                        </svg>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <h6>Enhanced Database Schema Legend:</h6>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <div style="width: 20px; height: 15px; background-color: #e3f2fd; border: 2px solid #1976d2;" class="me-2"></div>
                                        <span class="small">Control Tables</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <div style="width: 20px; height: 15px; background-color: #f3e5f5; border: 2px solid #7b1fa2;" class="me-2"></div>
                                        <span class="small">Enhanced Master Data (SCD2)</span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <div style="width: 20px; height: 15px; background-color: #e8f5e8; border: 2px solid #2e7d32;" class="me-2"></div>
                                        <span class="small">Enhanced Reference Data</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <div style="width: 20px; height: 15px; background-color: #ffcccb; border: 3px solid #d32f2f;" class="me-2"></div>
                                        <span class="small">NEW: PCS Engineering Tables</span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <div style="width: 20px; height: 15px; background-color: #f5f5f5; border: 1px dashed #757575;" class="me-2"></div>
                                        <span class="small">Enhanced Staging Tables</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <div style="width: 20px; height: 15px; background-color: #ffebee; border: 2px solid #d32f2f;" class="me-2"></div>
                                        <span class="small">Error & Audit</span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <div style="width: 20px; height: 2px; background-color: #00346a;" class="me-2"></div>
                                        <span class="small">Primary Relationships</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <div style="width: 20px; height: 1px; background-color: #999; border-top: 1px dashed #999;" class="me-2"></div>
                                        <span class="small">ETL Flow</span>
                                    </div>
                                </div>
                            </div>
                            <div class="alert alert-info mt-3">
                                <strong>Enhanced Field Coverage (Session 20):</strong> 
                                PLANTS now has 24+ fields (vs. 5 basic), ISSUES has 25+ fields (vs. 3 basic), 
                                and 4 new PCS engineering tables provide 100+ additional engineering fields for complete TR2000 API coverage.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. ETL Process Flow Chart -->
            <div class="card mb-4" id="flow-chart">
                <div class="card-header" style="background-color: #00346a; color: white;">
                    <h5 class="mb-0">4. ETL Process Flow Chart</h5>
                </div>
                <div class="card-body">
                    <div class="text-center mb-3">
                        <h6>Complete ETL Process Flow</h6>
                        <p class="text-muted">From API call to data storage with full audit trail</p>
                    </div>
                    
                    <div class="border rounded p-3" style="background-color: #f8f9fa; min-height: 500px;">
                        <svg width="100%" height="500" viewBox="0 0 1000 500">
                            <!-- Phase 1: Configuration -->
                            <g id="phase1">
                                <text x="50" y="20" class="fw-bold" fill="#00346a">Phase 1: Configuration</text>
                                
                                <rect x="20" y="30" width="100" height="50" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
                                <text x="70" y="50" text-anchor="middle" font-size="12" class="fw-bold">Plant Loader</text>
                                <text x="70" y="65" text-anchor="middle" font-size="10">Select Plants</text>
                                
                                <rect x="140" y="30" width="100" height="50" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
                                <text x="190" y="50" text-anchor="middle" font-size="12" class="fw-bold">Issue Loader</text>
                                <text x="190" y="65" text-anchor="middle" font-size="10">Select Issues</text>
                            </g>
                            
                            <!-- Phase 2: API Calls -->
                            <g id="phase2">
                                <text x="300" y="20" class="fw-bold" fill="#00346a">Phase 2: Data Extraction</text>
                                
                                <rect x="270" y="30" width="100" height="50" fill="#e8f5e8" stroke="#388e3c" stroke-width="2" rx="5"/>
                                <text x="320" y="50" text-anchor="middle" font-size="12" class="fw-bold">TR2000 API</text>
                                <text x="320" y="65" text-anchor="middle" font-size="10">Fetch Data</text>
                                
                                <rect x="390" y="30" width="100" height="50" fill="#fce4ec" stroke="#c2185b" stroke-width="2" rx="5"/>
                                <text x="440" y="50" text-anchor="middle" font-size="12" class="fw-bold">RAW_JSON</text>
                                <text x="440" y="65" text-anchor="middle" font-size="10">Audit Store</text>
                            </g>
                            
                            <!-- Phase 3: Staging -->
                            <g id="phase3">
                                <text x="50" y="130" class="fw-bold" fill="#00346a">Phase 3: Staging & Validation</text>
                                
                                <rect x="20" y="140" width="100" height="50" fill="#f5f5f5" stroke="#757575" stroke-width="2" rx="5" stroke-dasharray="5,5"/>
                                <text x="70" y="160" text-anchor="middle" font-size="12" class="fw-bold">STG Tables</text>
                                <text x="70" y="175" text-anchor="middle" font-size="10">Raw Insert</text>
                                
                                <rect x="140" y="140" width="100" height="50" fill="#fff8e1" stroke="#f9a825" stroke-width="2" rx="5"/>
                                <text x="190" y="160" text-anchor="middle" font-size="12" class="fw-bold">Deduplication</text>
                                <text x="190" y="175" text-anchor="middle" font-size="10">ROW_NUMBER</text>
                                
                                <rect x="260" y="140" width="100" height="50" fill="#e1f5fe" stroke="#0277bd" stroke-width="2" rx="5"/>
                                <text x="310" y="160" text-anchor="middle" font-size="12" class="fw-bold">Validation</text>
                                <text x="310" y="175" text-anchor="middle" font-size="10">Business Rules</text>
                            </g>
                            
                            <!-- Phase 4: SCD2 Processing -->
                            <g id="phase4">
                                <text x="420" y="130" class="fw-bold" fill="#00346a">Phase 4: SCD2 Processing</text>
                                
                                <rect x="380" y="140" width="80" height="40" fill="#ffebee" stroke="#d32f2f" stroke-width="2" rx="5"/>
                                <text x="420" y="157" text-anchor="middle" font-size="11" class="fw-bold">DELETE</text>
                                <text x="420" y="172" text-anchor="middle" font-size="9">Mark Removed</text>
                                
                                <rect x="480" y="140" width="80" height="40" fill="#e8f5e8" stroke="#388e3c" stroke-width="2" rx="5"/>
                                <text x="520" y="157" text-anchor="middle" font-size="11" class="fw-bold">REACTIVATE</text>
                                <text x="520" y="172" text-anchor="middle" font-size="9">Restore Deleted</text>
                                
                                <rect x="380" y="190" width="80" height="40" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
                                <text x="420" y="207" text-anchor="middle" font-size="11" class="fw-bold">UPDATE</text>
                                <text x="420" y="222" text-anchor="middle" font-size="9">New Version</text>
                                
                                <rect x="480" y="190" width="80" height="40" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
                                <text x="520" y="207" text-anchor="middle" font-size="11" class="fw-bold">INSERT</text>
                                <text x="520" y="222" text-anchor="middle" font-size="9">New Records</text>
                            </g>
                            
                            <!-- Phase 5: Final Storage -->
                            <g id="phase5">
                                <text x="620" y="130" class="fw-bold" fill="#00346a">Phase 5: Final Storage</text>
                                
                                <rect x="590" y="140" width="100" height="50" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="5"/>
                                <text x="640" y="160" text-anchor="middle" font-size="12" class="fw-bold">Dimension Tables</text>
                                <text x="640" y="175" text-anchor="middle" font-size="10">SCD2 History</text>
                                
                                <rect x="710" y="140" width="100" height="50" fill="#e0f2f1" stroke="#00695c" stroke-width="2" rx="5"/>
                                <text x="760" y="160" text-anchor="middle" font-size="12" class="fw-bold">Current Views</text>
                                <text x="760" y="175" text-anchor="middle" font-size="10">IS_CURRENT='Y'</text>
                            </g>
                            
                            <!-- Phase 6: Monitoring -->
                            <g id="phase6">
                                <text x="50" y="280" class="fw-bold" fill="#00346a">Phase 6: Monitoring & Reconciliation</text>
                                
                                <rect x="20" y="290" width="100" height="50" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
                                <text x="70" y="310" text-anchor="middle" font-size="12" class="fw-bold">ETL Control</text>
                                <text x="70" y="325" text-anchor="middle" font-size="10">Run Metrics</text>
                                
                                <rect x="140" y="290" width="100" height="50" fill="#fff8e1" stroke="#f9a825" stroke-width="2" rx="5"/>
                                <text x="190" y="310" text-anchor="middle" font-size="12" class="fw-bold">Reconciliation</text>
                                <text x="190" y="325" text-anchor="middle" font-size="10">Count Checks</text>
                                
                                <rect x="260" y="290" width="100" height="50" fill="#ffebee" stroke="#d32f2f" stroke-width="2" rx="5"/>
                                <text x="310" y="310" text-anchor="middle" font-size="12" class="fw-bold">Error Logging</text>
                                <text x="310" y="325" text-anchor="middle" font-size="10">Autonomous</text>
                            </g>
                            
                            <!-- Decision Points -->
                            <g id="decisions">
                                <text x="420" y="280" class="fw-bold" fill="#00346a">Decision Points</text>
                                
                                <polygon points="450,290 490,310 450,330 410,310" fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
                                <text x="450" y="313" text-anchor="middle" font-size="10" class="fw-bold">Success?</text>
                                
                                <polygon points="550,290 590,310 550,330 510,310" fill="#e8f5e8" stroke="#388e3c" stroke-width="2"/>
                                <text x="550" y="313" text-anchor="middle" font-size="10" class="fw-bold">COMMIT</text>
                                
                                <polygon points="650,290 690,310 650,330 610,310" fill="#ffebee" stroke="#d32f2f" stroke-width="2"/>
                                <text x="650" y="313" text-anchor="middle" font-size="10" class="fw-bold">ROLLBACK</text>
                            </g>
                            
                            <!-- Arrows showing flow -->
                            <!-- Configuration to API -->
                            <line x1="120" y1="55" x2="270" y2="55" stroke="#00346a" stroke-width="2" marker-end="url(#arrowhead2)"/>
                            <line x1="240" y1="55" x2="270" y2="55" stroke="#00346a" stroke-width="2" marker-end="url(#arrowhead2)"/>
                            
                            <!-- API to Staging -->
                            <line x1="320" y1="80" x2="70" y2="140" stroke="#00346a" stroke-width="2" marker-end="url(#arrowhead2)"/>
                            <line x1="440" y1="80" x2="440" y2="140" stroke="#666" stroke-width="1" marker-end="url(#arrowhead2)"/>
                            
                            <!-- Staging flow -->
                            <line x1="120" y1="165" x2="140" y2="165" stroke="#00346a" stroke-width="2" marker-end="url(#arrowhead2)"/>
                            <line x1="240" y1="165" x2="260" y2="165" stroke="#00346a" stroke-width="2" marker-end="url(#arrowhead2)"/>
                            
                            <!-- Validation to SCD2 -->
                            <line x1="360" y1="165" x2="380" y2="165" stroke="#00346a" stroke-width="2" marker-end="url(#arrowhead2)"/>
                            
                            <!-- SCD2 to Dimension -->
                            <line x1="560" y1="190" x2="590" y2="165" stroke="#00346a" stroke-width="2" marker-end="url(#arrowhead2)"/>
                            
                            <!-- Dimension to Views -->
                            <line x1="690" y1="165" x2="710" y2="165" stroke="#00346a" stroke-width="2" marker-end="url(#arrowhead2)"/>
                            
                            <!-- To Monitoring -->
                            <line x1="640" y1="190" x2="70" y2="290" stroke="#666" stroke-width="1" marker-end="url(#arrowhead2)"/>
                            <line x1="640" y1="190" x2="190" y2="290" stroke="#666" stroke-width="1" marker-end="url(#arrowhead2)"/>
                            
                            <!-- Decision flow -->
                            <line x1="360" y1="315" x2="410" y2="310" stroke="#00346a" stroke-width="2" marker-end="url(#arrowhead2)"/>
                            <line x1="490" y1="310" x2="510" y2="310" stroke="#388e3c" stroke-width="2" marker-end="url(#arrowhead2)"/>
                            <line x1="490" y1="310" x2="610" y2="310" stroke="#d32f2f" stroke-width="2" marker-end="url(#arrowhead2)"/>
                            
                            <!-- Labels for decision paths -->
                            <text x="500" y="305" font-size="9" fill="#388e3c">YES</text>
                            <text x="620" y="305" font-size="9" fill="#d32f2f">NO</text>
                            
                            <!-- Key Features Annotations -->
                            <g id="annotations">
                                <text x="50" y="390" class="fw-bold" fill="#00346a">Key Features:</text>
                                <text x="50" y="410" font-size="12" fill="#666">• 70% API Reduction through Smart Scope Control</text>
                                <text x="50" y="425" font-size="12" fill="#666">• Atomic Transactions with Single COMMIT</text>
                                <text x="50" y="440" font-size="12" fill="#666">• Autonomous Error Logging (Survives Rollbacks)</text>
                                <text x="50" y="455" font-size="12" fill="#666">• Complete SCD2 with Change Type Tracking</text>
                                <text x="50" y="470" font-size="12" fill="#666">• Hash-based Change Detection with Oracle STANDARD_HASH</text>
                                
                                <text x="500" y="390" class="fw-bold" fill="#00346a">Performance Optimizations:</text>
                                <text x="500" y="410" font-size="12" fill="#666">• Set-based Operations (No Row-by-Row)</text>
                                <text x="500" y="425" font-size="12" fill="#666">• Deterministic Deduplication with STG_ID</text>
                                <text x="500" y="440" font-size="12" fill="#666">• Partial Indexes on IS_CURRENT</text>
                                <text x="500" y="455" font-size="12" fill="#666">• Compressed RAW_JSON with Auto-Cleanup</text>
                                <text x="500" y="470" font-size="12" fill="#666">• Cascade Deletion for Data Integrity</text>
                            </g>
                            
                            <!-- Arrow marker definition -->
                            <defs>
                                <marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                                    <polygon points="0 0, 10 3.5, 0 7" fill="#00346a"/>
                                </marker>
                            </defs>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- 5. ETL Operations Guide -->
            <div class="card mb-4" id="etl-operations">
                <div class="card-header" style="background-color: #00346a; color: white;">
                    <h5 class="mb-0">5. ETL Operations Page - Complete Guide</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <h6><i class="bi bi-info-circle me-2"></i>Quick Access</h6>
                        <p class="mb-0">Navigate to <strong>/etl-operations</strong> to access the main ETL management interface.</p>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Section 1: Database Setup</h6>
                            <ul>
                                <li><strong>Test Connection:</strong> Verify Oracle database connectivity</li>
                                <li><strong>Table Status:</strong> View current state of all tables with record counts</li>
                                <li><strong>ETL History:</strong> Recent ETL run history with metrics</li>
                            </ul>
                            
                            <h6>Section 2: Plant Loader Configuration</h6>
                            <ul>
                                <li><strong>Scope Control:</strong> Select which plants to process</li>
                                <li><strong>Add Plants:</strong> Choose from dropdown of all available plants</li>
                                <li><strong>Remove Plants:</strong> Remove plants from processing scope</li>
                                <li><strong>Impact:</strong> Only selected plants will be processed for Issues and References</li>
                            </ul>
                            
                            <h6>Section 3: Master Data ETL</h6>
                            <ul>
                                <li><strong>Load Operators:</strong> Import operator data (8 records)</li>
                                <li><strong>Load Plants:</strong> Import plant data (130 records)</li>
                                <li><strong>Load Issues:</strong> Import issues for selected plants only</li>
                                <li><strong>Preview SQL:</strong> View exact SQL operations before execution</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Section 4: Reference Data ETL</h6>
                            <ul>
                                <li><strong>VDS References:</strong> Valve Datasheet references</li>
                                <li><strong>EDS References:</strong> Equipment Datasheet references</li>
                                <li><strong>MDS References:</strong> Material Datasheet references (includes AREA field)</li>
                                <li><strong>VSK References:</strong> Vessel Sketch references</li>
                                <li><strong>ESK References:</strong> Equipment Sketch references</li>
                                <li><strong>Pipe Element References:</strong> Different structure with TAG_NO</li>
                            </ul>
                            
                            <h6>Section 5: Issue Loader (70% API Reduction)</h6>
                            <ul>
                                <li><strong>Smart Selection:</strong> Choose specific issues for reference loading</li>
                                <li><strong>Cascade Impact:</strong> Only selected issues will load references</li>
                                <li><strong>Performance:</strong> Reduces API calls from 500+ to ~30</li>
                                <li><strong>Auto-cleanup:</strong> Removing plants cascades to issues and references</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="alert alert-success mt-3">
                        <h6><i class="bi bi-check-circle me-2"></i>Best Practice Workflow</h6>
                        <ol class="mb-0">
                            <li><strong>Configure Plant Loader:</strong> Add 3-5 plants you're working on</li>
                            <li><strong>Load Master Data:</strong> Operators → Plants → Issues (in order)</li>
                            <li><strong>Configure Issue Loader:</strong> Select specific issues for reference loading</li>
                            <li><strong>Load References:</strong> Process only the reference types you need</li>
                            <li><strong>Monitor Progress:</strong> Check ETL history and table status</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- 6. Master Data Management -->
            <div class="card mb-4" id="master-data">
                <div class="card-header" style="background-color: #00346a; color: white;">
                    <h5 class="mb-0">6. Master Data Management</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6>Operators</h6>
                            <div class="alert alert-light">
                                <strong>Records:</strong> ~8<br>
                                <strong>Key Fields:</strong> OPERATOR_ID, OPERATOR_NAME<br>
                                <strong>Load Time:</strong> &lt; 5 seconds<br>
                                <strong>Dependencies:</strong> None (load first)
                            </div>
                            <p><strong>Purpose:</strong> Master list of operating companies. Required for Plants as it provides the OPERATOR_ID foreign key.</p>
                        </div>
                        <div class="col-md-4">
                            <h6>Plants</h6>
                            <div class="alert alert-light">
                                <strong>Records:</strong> ~130<br>
                                <strong>Key Fields:</strong> PLANT_ID, PLANT_NAME, OPERATOR_ID<br>
                                <strong>Load Time:</strong> &lt; 10 seconds<br>
                                <strong>Dependencies:</strong> Operators (for OPERATOR_ID)
                            </div>
                            <p><strong>Purpose:</strong> Complete plant catalog. Use Plant Loader to select which plants to process for Issues.</p>
                        </div>
                        <div class="col-md-4">
                            <h6>Issues</h6>
                            <div class="alert alert-light">
                                <strong>Records:</strong> Variable (depends on Plant Loader)<br>
                                <strong>Key Fields:</strong> PLANT_ID, ISSUE_REVISION<br>
                                <strong>Load Time:</strong> 10-60 seconds<br>
                                <strong>Dependencies:</strong> Plants, Plant Loader configuration
                            </div>
                            <p><strong>Purpose:</strong> Issue revisions for selected plants. Forms the basis for reference data loading.</p>
                        </div>
                    </div>
                    
                    <h6>SCD2 Change Tracking</h6>
                    <p>All master data tables implement Slowly Changing Dimension Type 2 (SCD2) which provides:</p>
                    <div class="row">
                        <div class="col-md-6">
                            <ul>
                                <li><strong>INSERT:</strong> New records from API</li>
                                <li><strong>UPDATE:</strong> Changed records (new version created)</li>
                                <li><strong>DELETE:</strong> Records missing from API (soft delete)</li>
                                <li><strong>REACTIVATE:</strong> Previously deleted records that return</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul>
                                <li><strong>VALID_FROM/VALID_TO:</strong> Temporal validity</li>
                                <li><strong>IS_CURRENT:</strong> Current version flag</li>
                                <li><strong>CHANGE_TYPE:</strong> Audit trail of changes</li>
                                <li><strong>SRC_HASH:</strong> Change detection hash</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 7. Reference Data Management -->
            <div class="card mb-4" id="reference-data">
                <div class="card-header" style="background-color: #00346a; color: white;">
                    <h5 class="mb-0">7. Reference Data Management</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>VDS References (Valve Datasheets)</h6>
                            <div class="alert alert-success">
                                <strong>Typical Records:</strong> 2000+<br>
                                <strong>Key Fields:</strong> VDS_NAME, VDS_REVISION<br>
                                <strong>Special Fields:</strong> OFFICIAL_REVISION, DELTA<br>
                                <strong>Load Time:</strong> 30-60 seconds
                            </div>
                            
                            <h6>EDS References (Equipment Datasheets)</h6>
                            <div class="alert alert-info">
                                <strong>Typical Records:</strong> 20-50<br>
                                <strong>Key Fields:</strong> EDS_NAME, EDS_REVISION<br>
                                <strong>Special Fields:</strong> OFFICIAL_REVISION, DELTA<br>
                                <strong>Load Time:</strong> 5-10 seconds
                            </div>
                            
                            <h6>MDS References (Material Datasheets)</h6>
                            <div class="alert alert-warning">
                                <strong>Typical Records:</strong> 500-1000<br>
                                <strong>Key Fields:</strong> MDS_NAME, MDS_REVISION<br>
                                <strong>Special Fields:</strong> AREA (unique to MDS)<br>
                                <strong>Load Time:</strong> 20-40 seconds
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>VSK References (Vessel Sketches)</h6>
                            <div class="alert alert-primary">
                                <strong>Typical Records:</strong> 200-500<br>
                                <strong>Key Fields:</strong> VSK_NAME, VSK_REVISION<br>
                                <strong>Special Fields:</strong> OFFICIAL_REVISION, DELTA<br>
                                <strong>Load Time:</strong> 10-20 seconds
                            </div>
                            
                            <h6>ESK References (Equipment Sketches)</h6>
                            <div class="alert alert-secondary">
                                <strong>Typical Records:</strong> 0-10 (often empty)<br>
                                <strong>Key Fields:</strong> ESK_NAME, ESK_REVISION<br>
                                <strong>Special Fields:</strong> OFFICIAL_REVISION, DELTA<br>
                                <strong>Load Time:</strong> &lt; 5 seconds
                            </div>
                            
                            <h6>Pipe Element References</h6>
                            <div class="alert alert-dark">
                                <strong>Typical Records:</strong> 1000+<br>
                                <strong>Key Fields:</strong> TAG_NO (unique structure)<br>
                                <strong>Special Fields:</strong> ELEMENT_TYPE, ELEMENT_SIZE, RATING, MATERIAL<br>
                                <strong>Load Time:</strong> 20-40 seconds
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <h6><i class="bi bi-lightbulb me-2"></i>70% API Call Reduction Strategy</h6>
                        <p class="mb-2">The Issue Loader provides dramatic performance improvements:</p>
                        <ul class="mb-0">
                            <li><strong>Without Issue Loader:</strong> Processes ALL issues for selected plants (500+ API calls)</li>
                            <li><strong>With Issue Loader:</strong> Processes only selected issues (~30 API calls)</li>
                            <li><strong>Result:</strong> 70% reduction in API calls and processing time</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 8. Troubleshooting -->
            <div class="card mb-4" id="troubleshooting">
                <div class="card-header" style="background-color: #00346a; color: white;">
                    <h5 class="mb-0">8. Troubleshooting Guide</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Common Issues</h6>
                            
                            <div class="alert alert-danger">
                                <strong>Database Connection Failed</strong>
                                <ul class="mb-0">
                                    <li>Check Oracle service is running</li>
                                    <li>Verify connection string in appsettings.json</li>
                                    <li>Test with: <code>sqlplus TR2000_STAGING/piping@host.docker.internal:1521/XEPDB1</code></li>
                                </ul>
                            </div>
                            
                            <div class="alert alert-warning">
                                <strong>ETL Operations Show Zero Records</strong>
                                <ul class="mb-0">
                                    <li>Check Plant Loader configuration (Section 2)</li>
                                    <li>Ensure plants are added to loader</li>
                                    <li>Load master data in order: Operators → Plants → Issues</li>
                                </ul>
                            </div>
                            
                            <div class="alert alert-info">
                                <strong>Reference Loading Takes Too Long</strong>
                                <ul class="mb-0">
                                    <li>Use Issue Loader to select specific issues</li>
                                    <li>Start with 2-3 plants maximum</li>
                                    <li>Load reference types individually, not all at once</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>Error Investigation</h6>
                            
                            <div class="alert alert-light">
                                <strong>ETL_ERROR_LOG Table</strong>
                                <p>All errors are logged to ETL_ERROR_LOG with:</p>
                                <ul class="mb-0">
                                    <li><strong>ERROR_SOURCE:</strong> Which component failed</li>
                                    <li><strong>ERROR_MESSAGE:</strong> Detailed error description</li>
                                    <li><strong>STACK_TRACE:</strong> Full technical details</li>
                                    <li><strong>ETL_RUN_ID:</strong> Links to specific ETL run</li>
                                </ul>
                            </div>
                            
                            <div class="alert alert-success">
                                <strong>Performance Monitoring</strong>
                                <p>Check ETL_CONTROL table for:</p>
                                <ul class="mb-0">
                                    <li><strong>PROCESSING_TIME_SEC:</strong> How long ETL took</li>
                                    <li><strong>API_CALL_COUNT:</strong> Number of API calls made</li>
                                    <li><strong>RECORDS_*:</strong> Counts of loaded/updated/deleted</li>
                                    <li><strong>STATUS:</strong> SUCCESS/FAILED/RUNNING</li>
                                </ul>
                            </div>
                            
                            <h6>Recovery Actions</h6>
                            <ul>
                                <li><strong>Failed ETL Run:</strong> Check error log, fix issue, re-run</li>
                                <li><strong>Partial Data:</strong> ETL is atomic - either all succeeds or all rolls back</li>
                                <li><strong>Orphaned Data:</strong> Use cascade deletion by removing/re-adding plants</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 9. Best Practices -->
            <div class="card mb-4" id="best-practices">
                <div class="card-header" style="background-color: #00346a; color: white;">
                    <h5 class="mb-0">9. Best Practices</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Performance Optimization</h6>
                            <ul>
                                <li><strong>Start Small:</strong> Begin with 2-3 plants in Plant Loader</li>
                                <li><strong>Use Issue Loader:</strong> Select only issues you need for reference data</li>
                                <li><strong>Load Sequentially:</strong> Master data first, then references</li>
                                <li><strong>Monitor Progress:</strong> Check ETL history for performance trends</li>
                                <li><strong>Cleanup Regularly:</strong> System auto-cleans but monitor table sizes</li>
                            </ul>
                            
                            <h6>Data Quality</h6>
                            <ul>
                                <li><strong>Preview SQL:</strong> Always review operations before execution</li>
                                <li><strong>Check Reconciliation:</strong> Verify record counts match expectations</li>
                                <li><strong>Monitor Error Log:</strong> Review ETL_ERROR_LOG regularly</li>
                                <li><strong>Validate Results:</strong> Spot-check data in current views</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Operational Workflow</h6>
                            <ol>
                                <li><strong>Daily Startup:</strong>
                                    <ul>
                                        <li>Test database connection</li>
                                        <li>Review ETL history from previous day</li>
                                        <li>Check error log for any issues</li>
                                    </ul>
                                </li>
                                <li><strong>Weekly Data Refresh:</strong>
                                    <ul>
                                        <li>Update Plant Loader with current projects</li>
                                        <li>Refresh master data (Operators → Plants → Issues)</li>
                                        <li>Update reference data for active issues</li>
                                    </ul>
                                </li>
                                <li><strong>Monthly Maintenance:</strong>
                                    <ul>
                                        <li>Review table sizes and performance</li>
                                        <li>Clean up old Plant Loader entries</li>
                                        <li>Archive old ETL runs if needed</li>
                                    </ul>
                                </li>
                            </ol>
                            
                            <h6>Security Considerations</h6>
                            <ul>
                                <li><strong>Database Access:</strong> Use dedicated ETL user account</li>
                                <li><strong>API Keys:</strong> Rotate credentials regularly</li>
                                <li><strong>Audit Trail:</strong> All changes tracked in SCD2 history</li>
                                <li><strong>Error Logs:</strong> May contain sensitive data - handle appropriately</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 10. Technical Details -->
            <div class="card mb-4" id="technical-details">
                <div class="card-header" style="background-color: #00346a; color: white;">
                    <h5 class="mb-0">10. Technical Details</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Database Architecture</h6>
                            <div class="alert alert-light">
                                <strong>Database:</strong> Oracle 21c Express Edition<br>
                                <strong>Schema:</strong> TR2000_STAGING<br>
                                <strong>Connection:</strong> host.docker.internal:1521/XEPDB1<br>
                                <strong>User:</strong> TR2000_STAGING/piping
                            </div>
                            
                            <h6>Table Structure</h6>
                            <ul>
                                <li><strong>Control Tables:</strong> ETL_CONTROL, ETL_PLANT_LOADER, ETL_ISSUE_LOADER</li>
                                <li><strong>Staging Tables:</strong> STG_* (temporary, with deduplication flags)</li>
                                <li><strong>Dimension Tables:</strong> Master data and references (SCD2)</li>
                                <li><strong>Audit Tables:</strong> ETL_ERROR_LOG, RAW_JSON, ETL_RECONCILIATION</li>
                            </ul>
                            
                            <h6>Key Stored Procedures</h6>
                            <ul>
                                <li><strong>SP_PROCESS_ETL_BATCH:</strong> Master orchestrator</li>
                                <li><strong>SP_DEDUPLICATE_STAGING:</strong> Handles duplicates</li>
                                <li><strong>PKG_*_ETL:</strong> Entity-specific packages</li>
                                <li><strong>LOG_ETL_ERROR:</strong> Autonomous error logging</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Application Architecture</h6>
                            <div class="alert alert-light">
                                <strong>Framework:</strong> .NET 9.0 Blazor Server<br>
                                <strong>ORM:</strong> Dapper<br>
                                <strong>Database Driver:</strong> Oracle.ManagedDataAccess.Core<br>
                                <strong>UI Framework:</strong> Bootstrap 5
                            </div>
                            
                            <h6>Key Classes</h6>
                            <ul>
                                <li><strong>OracleETLServiceV2:</strong> Main ETL service</li>
                                <li><strong>TR2000ApiService:</strong> API communication</li>
                                <li><strong>ETLModels:</strong> All data models</li>
                                <li><strong>ETLOperations.razor:</strong> Main UI page</li>
                            </ul>
                            
                            <h6>Configuration</h6>
                            <ul>
                                <li><strong>Connection String:</strong> appsettings.json</li>
                                <li><strong>API Endpoints:</strong> Hardcoded in service</li>
                                <li><strong>Timeout Settings:</strong> 5 minutes for large datasets</li>
                                <li><strong>Memory:</strong> Optimized for large JSON responses</li>
                            </ul>
                            
                            <h6>Deployment</h6>
                            <ul>
                                <li><strong>DDL Script:</strong> Oracle_DDL_SCD2_FINAL.sql</li>
                                <li><strong>Application:</strong> Self-contained .NET application</li>
                                <li><strong>Dependencies:</strong> Oracle 21c XE, .NET 9.0 Runtime</li>
                                <li><strong>Monitoring:</strong> Built-in ETL history and error logging</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <h6><i class="bi bi-gear me-2"></i>Production Deployment Notes</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="mb-0">
                                    <li>Deploy DDL script to create all database objects</li>
                                    <li>Configure connection string for production Oracle instance</li>
                                    <li>Set up monitoring for ETL_ERROR_LOG table</li>
                                    <li>Schedule regular Plant Loader maintenance</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="mb-0">
                                    <li>Configure IIS or similar web server for Blazor Server</li>
                                    <li>Set up SSL certificates for production use</li>
                                    <li>Implement authentication if required</li>
                                    <li>Monitor performance and scale as needed</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
</div>

<style>
    .nav-link {
        scroll-behavior: smooth;
    }
    
    .card-header {
        position: sticky;
        top: 0;
        z-index: 1000;
    }
    
    svg text {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .alert {
        border-radius: 8px;
    }
    
    .border {
        overflow-x: auto;
    }
    
    @@media (max-width: 768px) {
        svg {
            min-width: 800px;
        }
    }
</style>